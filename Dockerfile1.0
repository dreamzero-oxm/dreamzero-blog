# 指定node版本为21.7.1  | 注：node 中默认含 npm 等指令 | 注: 需要提前下载node 21.7.1 的镜像(docker pull node:12.7.1 / docker pull node:14 / ...)
FROM node:22.20.0-alpine

ARG NEED_MIRROR=0

# 项目在docker里面的工作目录，/app 只是随意指定的目录而已
WORKDIR /app

# 设置npm国内淘宝镜像
RUN if [ "$NEED_MIRROR" == "1" ]; then \
        npm config set registry https://registry.npmmirror.com; \
    fi;


# pnpm 安装
RUN npm install -g pnpm

# 安装pnpm国内淘宝镜像
RUN if [ "$NEED_MIRROR" == "1" ]; then \
        pnpm config set registry https://registry.npmmirror.com; \
    fi;

# 把当前目录(第1个.)下的所有文件添加到docker里面的 /app  目录
COPY . /app

RUN npm install
RUN pnpm build
EXPOSE 9999

ENTRYPOINT [ "pnpm", "start" ]
